# 第四章：shell脚本编程基础（实验）
Don't repeat yourself.
---
# 实验报告要求
- 继承第一章：Linux基础（实验）的所有实验报告要求
- 上述任务的所有源代码文件必须单独提交并提供详细的–help脚本内置帮助信息
- 任务二的所有统计数据结果要求写入独立实验报告
---
# 任务一：用bash编写一个图片批处理脚本，实现以下功能：
- √支持命令行参数方式使用不同功能   
         
      bash mission1.sh -h
   - ![获取帮助内置函数](img4\task1获取帮助.png)

- √支持对指定目录下所有支持格式的图片文件进行批处理
- √支持以下常见图片批处理功能的单独使用或组合使用:
   - 支持对jpeg格式图片进行图片质量压缩

         bash mission1.sh -d images -c 80

      ![压缩前后对照](img4\task1compress.png)

   - 支持对jpeg/png/svg格式图片在保持原始宽高比的前提下压缩分辨率

           bash mission1.sh -d images -s 40
      ![压缩](img4\task1压缩.png)   

   - 支持对图片批量添加自定义文本水印

           bash mission1.sh -d images -a black 50 azurehpz
      ![水印](img4\task1add.png)  
      ![生成水印文件](img4\task1生成add.png) 
   - 支持批量重命名（统一添加文件名前缀或后缀，不影响原始文件扩展名）
         
          bash mission1.sh -d images -n 3021
      ![生成重命名文件](img4\task1rename.png) 

   - 支持将png/svg图片统一转换为jpg格式图片
         
         bash mission1.sh -d images -t
   ![转换](img4\task1convert.png)

## 实验代码及结果
- [task1实验代码](mission1.sh)
- [Task1实验输出的结果-Imagesprocessed](images_processed)

## 出现的问题及解决方法
   - 1.完成脚本编写后运行调试，报错`convert：command not found`
      - 网上搜索报错后，`convert`是`imagemagick`下的命令，要先安装`imagemagick`才能使用`convert`命令   

            sudo apt-get install imagemagick
       - 进行上述步骤后，依然报错
`E: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?`,于是又在网上继续搜索解决方案。   
        
             sudo apt-get update --fix-missing
       - 发现依旧报错，说明sources本身有问题，需要更换。   
            
             #先将sources.list备份到sources.list.bak
             # 注意要先cd出到etc/这个目录里
             sudo cp sources.list sources.list.bak

             # 更换sources.list的内容

             #再次更新
             sudo apt-get update

        更新后不报错，问题解决。

   - 2.在脚本文件开头加入了dir='pwd',echo $dir。接着在下面进行遍历操作时写入了for file in 'ls $dir',报错ls:pwd not found。
      - 这样操作发现，ls和pwd两个命令是重复的，删除掉dir='pwd'即成功运行。同时也要注意,\`ls $dir\`的\`是Tab键上方的，而并非单引号。

---
## 参考文献
- [linux-2019-Jasmine2020](https://github.com/CUCCS/linux-2019-Jasmine2020/blob/linux4/Lab4_Shell%E7%BC%96%E7%A8%8B/lab4%20shell%E7%BC%96%E7%A8%8B.md)
- [Shell获取文件后缀名](https://blog.csdn.net/rainharder/article/details/6030255?utm_source=blogxgwz1)
- [linux中convert用法](https://www.cnblogs.com/robben/p/4315123.html)
- [vim如何复制到系统剪贴板](https://www.cnblogs.com/Biiigwang/p/12086514.html)
- [psftp的用法（超级详细）](https://blog.csdn.net/zxl315/article/details/5955202/)
- [E: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?](https://www.cnblogs.com/X-knight/p/10598076.html)
---


# 任务二：用bash编写一个文本批处理脚本，对以下附件分别进行批量处理完成相应的数据统计任务：
## 2014世界杯运动员数据
- 统计不同年龄区间范围（20岁以下、[20-30]、30岁以上）的球员数量、百分比
- 统计不同场上位置的球员数量、百分比
- 名字最长的球员是谁？名字最短的球员是谁？
- 年龄最大的球员是谁？年龄最小的球员是谁？

## 代码
- [Task2实验代码](mission2.sh)
## 实验结果
- ![task2实验结果](img4\task2实验结果.png)
- [Task2实验结果](Task2实验结果.md)
## 参考文献
- [linux-2019-Jasmine2020](https://github.com/CUCCS/linux-2019-Jasmine2020/blob/linux4/Lab4_Shell%E7%BC%96%E7%A8%8B/lab4%20shell%E7%BC%96%E7%A8%8B.md)
- [Linux命令行中对表格类型文本的几处操作总结](https://blog.csdn.net/chenzai1946/article/details/100718319)
- [shell脚本进阶之数组基础](https://blog.51cto.com/14012942/2432919)
- [Shell脚本中awk指令的用法](https://www.jb51.net/article/157432.htm)

---
## Web服务器访问日志
- 统计访问来源主机TOP 100和分别对应出现的总次数
- 统计访问来源主机TOP 100 IP和分别对应出现的总次数
- 统计最频繁被访问的URL TOP 100
- 统计不同响应状态码的出现次数和对应百分比
- 分别统计不同4XX状态码对应的TOP 10 URL和对应出现的总次数
- 给定URL输出TOP 100访问来源主机

## 实验代码及结果
- [task3实验脚本代码](mission3.sh)
- [Task3实验输出结果](web_calculate.txt)
---
## 参考文献
- [linux-2019-Jasmine2020](https://github.com/CUCCS/linux-2019-Jasmine2020/blob/linux4/Lab4_Shell%E7%BC%96%E7%A8%8B/lab4%20shell%E7%BC%96%E7%A8%8B.md)
- [Linux awk 命令](https://www.runoob.com/linux/linux-comm-awk.html)